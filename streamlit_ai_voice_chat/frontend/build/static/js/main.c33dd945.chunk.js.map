{"version":3,"sources":["Dictaphone.jsx","MediaDisplay.jsx","VoiceGPT.jsx","Main.tsx","index.tsx"],"names":["Dictaphone","_ref","commands","myFunc","listenAfterReply","no_response_time","apiInProgress","listenButton","session_listen","initialFinalTranscript","splitImage","finalTranscript","interimTranscript","resetTranscript","listening","browserSupportsSpeechRecognition","isMicrophoneAvailable","useSpeechRecognition","editableTranscript","setEditableTranscript","useState","show_transcript","setShowTranscript","selectedText","setSelectedText","selectionStart","setSelectionStart","selectionEnd","setSelectionEnd","showReplaceBox","setShowReplaceBox","replaceInput","setReplaceInput","isProcessingReplace","setIsProcessingReplace","textareaRef","useRef","cursorPosRef","replaceInputRef","handleTextSelection","current","start","end","selected","substring","length","handleReplaceText","async","trim","replaceCommand","api_body","action","original_text","replacement_prompt","result","undefined","_replaceInputRef$curr","console","log","originalPlaceholder","placeholder","setTimeout","newTranscript","focus","newCursorPos","setSelectionRange","error","handleCancelReplace","processTranscript","useCallback","prev","keywordFound","i","keywords","j","keyword","RegExp","search","useEffect","React","createElement","Fragment","style","display","gap","marginBottom","onClick","backgroundColor","color","border","padding","borderRadius","cursor","fontSize","showTranscript_func","clearTranscript_func","disabled","title","position","boxShadow","fontWeight","fontStyle","alignItems","ref","type","value","onChange","e","target","onKeyDown","key","flex","marginTop","flexDirection","maxHeight","height","overflowY","animation","marginLeft","onSelect","onMouseUp","onKeyUp","width","resize","MediaDisplay","showImage","imageSrc","largeHeight","largeWidth","smallHeight","smallWidth","className","justifyContent","toLowerCase","endsWith","maxWidth","objectFit","controls","autoPlay","loop","muted","src","alt","g_anwers","CustomVoiceGPT","props","_refresh_ask$color_di","api","kwargs","show_video","input_text","face_recon","api_key","refresh_ask","self_image","api_audio","client_user","force_db_root","before_trigger","agent_actions","setImageSrc","imageSrc_name","setImageSrc_name","message","setMessage","answers","setAnswers","setListenAfterReply","modelsLoaded","setModelsLoaded","captureVideo","setCaptureVideo","textString","setTextString","setApiInProgress","speaking","setSpeakingInProgress","setlistening","show_conversation","setshow_conversation","showTooltip","setShowTooltip","showTooltip_conv","setShowTooltip_conv","setlistenButton","setsession_listen","convo_button","setconvo_button","before_trigger_vars","before_trigger_","faceData","audioRef","UserUsedChatWindow","setUserUsedChatWindow","buttonName","setButtonName","buttonName_listen","setButtonName_listen","setShowImage","selectedActions","setSelectedActions","datatree","setDataTree","datatreeTitle","setDataTreeTitle","datatree_title","selectedNodes","setSelectedNodes","collapsed","setCollapsed","windowWidth","setWindowWidth","window","innerWidth","fetchImageData","response","axios","get","imageUrl","responseType","objectUrl","URL","createObjectURL","data","listenContinuously","SpeechRecognition","startListening","continuous","language","isMobile","test","navigator","userAgent","editingDataframe","setEditingDataframe","editedDataframe","setEditedDataframe","ret","command","originalText","replacementPrompt","_command$api_body","_command$api_body2","text","user","dataframe","body","tigger_type","face_data","selected_actions","selected_nodes","post","pause","apiUrlWithFileName","Audio","play","Promise","resolve","onended","location","href","stopListening","findNodeByKey","tree","k","Object","entries","children","found","background_color_chat","color_dict","split","firstKey","nodeObj","nodeTitle","field_name","nodeLink","hyperlink","showSidebar","setShowSidebar","sidebarWide","setSidebarWide","minHeight","flexShrink","marginRight","background","outline","transition","aria-label","margin","alignSelf","borderRight","onSelectionChange","renderNodes","level","arguments","parentKeys","Array","isArray","map","_ref2","idx","nodePath","join","hasChildren","keys","isCollapsed","isLast","whiteSpace","fontFamily","paddingTop","paddingBottom","left","top","zIndex","bottom","[object Object]","toggleCollapse","lineHeight","userSelect","tabIndex","checked","includes","newSelected","filter","handleSelect","rel","textDecoration","overflow","textOverflow","verticalAlign","minWidth","slice","node","answer","textAlign","wordBreak","resp","dangerouslySetInnerHTML","__html","event","borderCollapse","col","row","rowIdx","newDF","r","flexWrap","click_listenButton","role","onMouseEnter","onMouseLeave","transform","pointerEvents","listenSession","a","withStreamlitConnection","args","Streamlit","setFrameHeight","VoiceGPT","engine","Styletron","ReactDOM","render","StrictMode","StyletronProvider","ThemeProvider","theme","LightTheme","Main","document","getElementById"],"mappings":"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","file":"static/js/main.c33dd945.chunk.js","sourcesContent":["import React, { useState, useEffect, useRef, useCallback} from \"react\";\nimport SpeechRecognition, { useSpeechRecognition } from \"react-speech-recognition\";\n\nconst Dictaphone = ({\n  commands,\n  myFunc,\n  listenAfterReply = false,\n  no_response_time = 3,\n  apiInProgress = false,\n  listenButton = false,\n  session_listen = false,\n  initialFinalTranscript = \"\",\n  splitImage = false,\n}) => {\n  const {\n    finalTranscript,\n    interimTranscript,\n    resetTranscript,\n    listening,\n    browserSupportsSpeechRecognition,\n    isMicrophoneAvailable,\n  } = useSpeechRecognition();\n\n  const [editableTranscript, setEditableTranscript] = useState(\"\");\n  const [show_transcript, setShowTranscript] = useState(true);\n  \n  // New states for text selection and replacement\n  const [selectedText, setSelectedText] = useState(\"\");\n  const [selectionStart, setSelectionStart] = useState(0);\n  const [selectionEnd, setSelectionEnd] = useState(0);\n  const [showReplaceBox, setShowReplaceBox] = useState(false);\n  const [replaceInput, setReplaceInput] = useState(\"\");\n  const [isProcessingReplace, setIsProcessingReplace] = useState(false);\n\n  const textareaRef = useRef(null);\n  const cursorPosRef = useRef(null);\n  const replaceInputRef = useRef(null);\n\n  // Handle text selection in textarea\n  const handleTextSelection = () => {\n    if (textareaRef.current) {\n      const start = textareaRef.current.selectionStart;\n      const end = textareaRef.current.selectionEnd;\n      const selected = editableTranscript.substring(start, end);\n      \n      if (selected.length > 0) {\n        setSelectedText(selected);\n        setSelectionStart(start);\n        setSelectionEnd(end);\n        // setShowReplaceBox(true);\n        setReplaceInput(\"\"); // Clear previous input\n      } else {\n      setSelectedText(\"\");\n      setSelectionStart(0);\n      setSelectionEnd(0);\n      }\n    }\n  };\n\n  // Handle the replace operation\nconst handleReplaceText = async () => {\n  if (!replaceInput.trim() || !selectedText) return;\n\n  setIsProcessingReplace(true);\n  \n  try {\n    // Create a special command for text replacement\n    const replaceCommand = {\n      api_body: {\n        action: \"replace_text\",\n        original_text: selectedText,\n        replacement_prompt: replaceInput.trim()\n      }\n    };\n    \n    // Call myFunc and wait for the result\n    const result = await myFunc(replaceInput.trim(), replaceCommand, 9);\n    \n    // Check if result is valid for replacement\n    if (result === null || \n        result === undefined || \n        result === \"\" || \n        result === \"None\" ||\n        (typeof result === 'string' && result.trim() === \"\")) {\n      \n      console.log(\"MyFunc returned empty/null result, not replacing text\");\n      \n      // Show user feedback that no replacement occurred\n      setReplaceInput(\"\"); // Clear input but keep box open\n      \n      // Optional: Show a temporary message\n      const originalPlaceholder = replaceInputRef.current?.placeholder;\n      if (replaceInputRef.current) {\n        replaceInputRef.current.placeholder = \"No replacement text returned - try a different prompt\";\n        setTimeout(() => {\n          if (replaceInputRef.current) {\n            replaceInputRef.current.placeholder = originalPlaceholder || \"Enter replacement text or prompt...\";\n          }\n        }, 3000);\n      }\n      \n      return; // Exit without replacing text\n    }\n\n    // Replace the selected text with the result\n    const newTranscript = \n      editableTranscript.substring(0, selectionStart) + \n      result + \n      editableTranscript.substring(selectionEnd);\n    \n    setEditableTranscript(newTranscript);\n    setShowReplaceBox(false);\n    setSelectedText(\"\");\n    setReplaceInput(\"\");\n    \n    // Focus back to textarea and position cursor after replacement\n    if (textareaRef.current) {\n      textareaRef.current.focus();\n      const newCursorPos = selectionStart + result.length;\n      textareaRef.current.setSelectionRange(newCursorPos, newCursorPos);\n    }\n    \n  } catch (error) {\n    console.error(\"Error replacing text:\", error);\n    \n    // Show error feedback to user\n    if (replaceInputRef.current) {\n      const originalPlaceholder = replaceInputRef.current.placeholder;\n      replaceInputRef.current.placeholder = \"Error occurred during replacement\";\n      setTimeout(() => {\n        if (replaceInputRef.current) {\n          replaceInputRef.current.placeholder = originalPlaceholder || \"Enter replacement text or prompt...\";\n        }\n      }, 3000);\n    }\n  } finally {\n    setIsProcessingReplace(false);\n  }\n};\n\n  // Cancel replace operation\nconst handleCancelReplace = () => {\n  setShowReplaceBox(false);\n  setSelectedText(\"\");\n  setReplaceInput(\"\");\n  setSelectionStart(0);\n  setSelectionEnd(0);\n  if (textareaRef.current) {\n    textareaRef.current.focus();\n  }\n};\n\n\n\n  const showTranscript_func = () => setShowTranscript((prev) => !prev);\n  \n  const clearTranscript_func = () => {\n    resetTranscript();\n    setEditableTranscript(\"\");\n    setShowReplaceBox(false);\n    setSelectedText(\"\");\n  };\n\n  // Logic to process transcript based on session_listen\n  const processTranscript = useCallback(() => {\n    if (finalTranscript !== \"\") {\n\n      if (listenButton) {\n        // When session_listen is false and not using listenButton, just append\n        myFunc(finalTranscript, { api_body: {} }, 8);\n        setEditableTranscript((prev) => `${prev} ${finalTranscript}`.trim());\n        resetTranscript();\n        setEditableTranscript(\"\"); // Clear editable transcript state\n        return;\n      }\n\n\n      if (session_listen) {\n        // Check for keywords only when session_listen is true\n        let keywordFound = false;\n        for (let i = 0; i < commands.length; i++) {\n          const { keywords } = commands[i];\n          for (let j = 0; j < keywords.length; j++) {\n            const keyword = new RegExp(keywords[j], \"i\");\n            const isKeywordFound = finalTranscript.search(keyword) !== -1;\n  \n            if (isKeywordFound && !apiInProgress) {\n              console.log(`Keyword found: ${keywords[j]}`);\n              myFunc(finalTranscript, commands[i], 1);\n              resetTranscript(); // Reset transcript after processing keyword\n              // setEditableTranscript(\"\"); // Clear editable transcript state\n              keywordFound = true;\n              return;\n            }\n          }\n        }\n  \n        if (!keywordFound) {\n          // Append transcript if no keyword is found\n          setEditableTranscript((prev) => `${prev} ${finalTranscript}`.trim());\n          resetTranscript(); // Clear finalTranscript after appending\n        }\n      } else {\n        // When session_listen is false, focus on capturing speech-to-text\n        if (textareaRef.current) {\n          cursorPosRef.current = textareaRef.current.selectionStart;\n        }\n\n        console.log(\"Recording speech-to-text without keyword triggers\");\n        setEditableTranscript((prev) => `${prev} ${finalTranscript}`.trim());\n        resetTranscript(); // Clear finalTranscript after appending\n      }\n    }\n }, [finalTranscript, listenButton, session_listen, commands, apiInProgress]);\n\n  const handleTranscriptChange = (e) => {\n  setEditableTranscript(e.target.value); // Update editable transcript based on user input\n};\n\n  // Focus replace input when box appears\nuseEffect(() => {\n  if (showReplaceBox && replaceInputRef.current) {\n    setTimeout(() => {\n      replaceInputRef.current.focus();\n    }, 100);\n  }\n}, [showReplaceBox]);\n\nuseEffect(() => {\n  if (initialFinalTranscript) {\n    setEditableTranscript((prev) => `${prev} ${initialFinalTranscript}`.trim());\n  }\n  \n  processTranscript();\n}, [initialFinalTranscript, processTranscript]);\n\n\nuseEffect(() => {\n  if (textareaRef.current && cursorPosRef.current !== null) {\n    textareaRef.current.selectionStart = cursorPosRef.current;\n    textareaRef.current.selectionEnd = cursorPosRef.current;\n    cursorPosRef.current = null;\n  }\n  }, [editableTranscript]);\n\n\n  if (!browserSupportsSpeechRecognition) {\n    return <span>No browser support</span>;\n  }\n\n  if (!isMicrophoneAvailable) {\n    return <span>Please allow access to the microphone</span>;\n  }\n\n  return (\n    <>\n      <div style={{ display: \"flex\", gap: \"10px\", marginBottom: \"10px\" }}>\n        <button\n          onClick={() => {\n            myFunc(editableTranscript, { api_body: {} }, 5);\n            resetTranscript();\n            setEditableTranscript(\"\");\n            }}\n            style={{\n            backgroundColor: \"rgb(196, 230, 252)\",\n            color: \"black\",\n            border: \"none\",\n            padding: \"5px 10px\",\n            borderRadius: \"3px\",\n            cursor: \"pointer\",\n            fontSize: \"0.9em\",\n            }}\n          >\n            Send Transcript\n          </button>\n          <button\n            onClick={showTranscript_func}\n            style={{\n            backgroundColor: \"white\",\n            color: \"grey\",\n            border: \"none\",\n            padding: \"5px 10px\",\n            borderRadius: \"3px\",\n            cursor: \"pointer\",\n            fontSize: \"0.9em\",\n            }}\n          >\n            {show_transcript ? \"Hide Transcript\" : \"Show Transcript\"}\n          </button>\n          <button\n            onClick={clearTranscript_func}\n            style={{\n            backgroundColor: \"white\",\n            color: \"grey\",\n            border: \"none\",\n            padding: \"5px 10px\",\n            borderRadius: \"3px\",\n            cursor: \"pointer\",\n            fontSize: \"0.9em\",\n            }}\n          >\n            Clear Transcript\n          </button>\n\n        {/* New button to show replace functionality hint */}\n<button\n  onClick={() => {\n    if (selectedText) {\n      setShowReplaceBox(true);\n      setReplaceInput(\"\"); // Clear previous input\n    }\n  }}\n  disabled={!selectedText}\n  style={{\n    backgroundColor: selectedText ? \"rgb(255, 245, 157)\" : \"rgb(245, 245, 245)\",\n    color: selectedText ? \"black\" : \"grey\",\n    border: \"none\",\n    padding: \"5px 10px\",\n    borderRadius: \"3px\",\n    cursor: selectedText ? \"pointer\" : \"not-allowed\",\n    fontSize: \"0.8em\",\n  }}\n  title={selectedText ? \"Click to replace selected text\" : \"Select text in transcript first\"}\n>\n  {selectedText ? `Replace: \"${selectedText.substring(0, 20)}${selectedText.length > 20 ? '...' : ''}\"` : \"Select text to replace\"}\n</button>\n      </div>\n\n      {/* Replace text input box */}\n      {showReplaceBox && (\n        <div style={{\n          position: \"relative\",\n          backgroundColor: \"rgb(255, 248, 220)\",\n          border: \"2px solid rgb(255, 193, 7)\",\n          borderRadius: \"8px\",\n          padding: \"15px\",\n          marginBottom: \"10px\",\n          boxShadow: \"0 4px 12px rgba(0,0,0,0.15)\"\n        }}>\n          <div style={{ marginBottom: \"10px\", fontSize: \"0.9em\", fontWeight: \"bold\" }}>\n            Replace: \"<span style={{ fontStyle: \"italic\", color: \"#666\" }}>{selectedText}</span>\"\n          </div>\n          \n<div style={{ display: \"flex\", gap: \"8px\", alignItems: \"center\" }}>\n  <input\n    ref={replaceInputRef}\n    type=\"text\"\n    value={replaceInput}\n    onChange={(e) => setReplaceInput(e.target.value)}\n    onKeyDown={(e) => {\n      if (e.key === 'Enter') {\n        handleReplaceText();\n      } else if (e.key === 'Escape') {\n        handleCancelReplace();\n      }\n    }}\n    placeholder=\"Enter replacement text or prompt...\"\n    style={{\n      flex: 1,\n      padding: \"8px\",\n      border: \"1px solid #ddd\",\n      borderRadius: \"4px\",\n      fontSize: \"0.9em\"\n    }}\n    disabled={isProcessingReplace}\n  />\n  \n  <button\n    onClick={handleReplaceText}\n    disabled={!replaceInput.trim() || isProcessingReplace}\n    style={{\n      backgroundColor: isProcessingReplace ? \"#ccc\" : \"rgb(40, 167, 69)\",\n      color: \"white\",\n      border: \"none\",\n      padding: \"8px 15px\",\n      borderRadius: \"4px\",\n      cursor: isProcessingReplace ? \"not-allowed\" : \"pointer\",\n      fontSize: \"0.9em\",\n      fontWeight: \"bold\"\n    }}\n  >\n    {isProcessingReplace ? \"⏳\" : \"Replace\"}\n  </button>\n  \n  {/* ADD THIS CANCEL BUTTON */}\n  <button\n    onClick={handleCancelReplace}\n    disabled={isProcessingReplace}\n    style={{\n      backgroundColor: \"rgb(108, 117, 125)\",\n      color: \"white\",\n      border: \"none\",\n      padding: \"8px 15px\",\n      borderRadius: \"4px\",\n      cursor: isProcessingReplace ? \"not-allowed\" : \"pointer\",\n      fontSize: \"0.9em\",\n      fontWeight: \"bold\"\n    }}\n  >\n    Cancel\n  </button>\n</div>\n          \n          <div style={{ marginTop: \"8px\", fontSize: \"0.8em\", color: \"#666\" }}>\n            💡 Note: `Replace, will replace text with {splitImage}'s response`;\n          </div>\n        </div>\n      )}\n\n      {show_transcript && (\n        <div\n          style={{\n            display: \"flex\",\n            flexDirection: \"column\",\n            maxHeight: \"800px\",\n            height: \"550px\",\n            overflowY: \"auto\",\n            border: \"1px solid #ccc\",\n            padding: \"10px\",\n          }}\n        >\n          <span>\n            <strong>Listening:</strong>{\" \"}\n            <span\n              style={{\n                color: listening ? \"green\" : \"gray\",\n                fontWeight: 600,\n                animation: listening ? \"flash-green 1s infinite alternate\" : \"none\",\n              }}\n            >\n              {listening ? \"ON\" : \"OFF\"}\n            </span>\n            <style>\n              {`\n                @keyframes flash-green {\n                  0% { opacity: 1; }\n                  100% { opacity: 0.4; }\n                }\n              `}\n            </style>\n          </span>\n\n          <span>\n            <strong>Transcript:</strong>\n            {selectedText && (\n              <span style={{ marginLeft: \"10px\", fontSize: \"0.8em\", color: \"#666\" }}>\n                (`Replace with {splitImage}'s response`);\n              </span>\n            )}\n          </span>\n\n          {interimTranscript && (\n            <div style={{ color: \"#888\", fontStyle: \"italic\", marginBottom: \"8px\" }}>\n              {interimTranscript}\n            </div>\n          )}\n\n          <textarea\n            ref={textareaRef}\n            value={editableTranscript}\n            onChange={handleTranscriptChange}\n            onSelect={handleTextSelection} // Add selection handler\n            onMouseUp={handleTextSelection} // Handle mouse selection\n            onKeyUp={handleTextSelection} // Handle keyboard selection\n            style={{\n              backgroundColor: \"rgb(255, 255, 255)\",\n              color: \"black\",\n              width: \"100%\",\n              height: \"550px\",\n              border: \"1px solid #ccc\",\n              padding: \"5px\",\n              resize: \"none\",\n            }}\n          />\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default Dictaphone;","import React from 'react';\n\nconst MediaDisplay = ({ showImage, imageSrc, largeHeight = 100, largeWidth = 100, smallHeight = 40, smallWidth = 40 }) => {\n    // Determine the dimensions based on `showImage` status\n    const height = showImage ? largeHeight : smallHeight;\n    const width = showImage ? largeWidth : smallWidth;\n  \n    return (\n      <div className=\"p-2\" style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>\n        {/* Always show the image or video at the top center based on `showImage` */}\n        <div style={{ display: 'flex', justifyContent: 'center', width: '100%' }}>\n          {imageSrc && (\n            imageSrc.toLowerCase().endsWith(\".mp4\") ? (\n              <video\n                style={{ maxWidth: '100%', borderRadius: '8px', objectFit: 'cover' }}\n                height={height}\n                width={width}\n                controls={showImage} // Only show controls if `showImage` is true\n                autoPlay\n                loop={false}\n                muted\n              >\n                <source src={imageSrc} type=\"video/mp4\" />\n                Your browser does not support the video tag.\n              </video>\n            ) : (\n              <img\n                src={imageSrc}\n                height={height}\n                width={width}\n                style={{ maxWidth: '100%', borderRadius: '8px', objectFit: 'cover' }}\n                alt=\"Media Preview\"\n              />\n            )\n          )}\n        </div>\n      </div>\n    );\n  };\n  \n  export default MediaDisplay;","import React, { useState, useEffect, useRef } from \"react\";\nimport axios from \"axios\";\n// import { Streamlit } from \"streamlit-component-lib\";\nimport SpeechRecognition from \"react-speech-recognition\";\nimport Dictaphone from \"./Dictaphone\";\nimport MediaDisplay from \"./MediaDisplay\";\nimport './spinner.css';\n\n\n// let timer = null;\n// let faceTimer = null;\nlet g_anwers = [];\n// let firstFace = false;\n\nconst CustomVoiceGPT = (props) => {\n  const { api, kwargs = {} } = props;\n  const {\n    commands,\n    height,\n    width,\n    show_video,\n    input_text,\n    no_response_time,\n    face_recon,\n    api_key,\n    refresh_ask,\n    self_image,\n    api_audio,\n    client_user,\n    force_db_root,\n    before_trigger,\n    agent_actions,\n  } = kwargs;\n\n  const [imageSrc, setImageSrc] = useState(kwargs.self_image);\n  const [imageSrc_name, setImageSrc_name] = useState(kwargs.self_image);\n\n  const [message, setMessage] = useState(\"\");\n  const [answers, setAnswers] = useState(kwargs.answers || []);\n  const [listenAfterReply, setListenAfterReply] = useState(false);\n\n  const [modelsLoaded, setModelsLoaded] = useState(false);\n  const [captureVideo, setCaptureVideo] = useState(false);\n  const [textString, setTextString] = useState(\"\");\n  const [apiInProgress, setApiInProgress] = useState(false); // Added state for API in progress\n  const [speaking, setSpeakingInProgress] = useState(false); // Added state for API in progresslistening\n  const [listening, setlistening] = useState(false); // Added state for API in progress\n\n  const [show_conversation, setshow_conversation] = useState(true); // Added state for API in progress\n  // Inside your component:\nconst [showTooltip, setShowTooltip] = useState(false);\nconst [showTooltip_conv, setShowTooltip_conv] = useState(false);\n  const [listenButton, setlistenButton] = useState(false); // Added state for API in progress\n  const [session_listen, setsession_listen] = useState(false);\n  const [convo_button, setconvo_button] = useState(false); // Added state for API in progress\n\n  const [before_trigger_vars, before_trigger_] = useState(kwargs.before_trigger); \n  const faceData = useRef([]);\n  // const faceTriggered = useRef(false);\n  // const videoRef = useRef();\n  // const videoHeight = 480;\n  // const videoWidth = 640;\n  // const canvasRef = useRef();\n  const audioRef = useRef(null);\n  \n\n  const [UserUsedChatWindow, setUserUsedChatWindow] = useState(false);\n  const [buttonName, setButtonName] = useState(\"Click and Ask\");\n  const [buttonName_listen, setButtonName_listen] = useState(\"Listening\");\n\n  const [showImage, setShowImage] = useState(false); // Step 1: Define showImage state\n  const [selectedActions, setSelectedActions] = useState([]);\n  const [datatree, setDataTree] = useState(kwargs.datatree || {});\n  const [datatreeTitle, setDataTreeTitle] = useState(kwargs.datatree_title || \"\");\n\n\nconst [selectedNodes, setSelectedNodes] = useState([]);\n\n// SidebarTree with collapsible nodes, no text wrapping, and improved style\n// Move collapsed and setCollapsed state up to the parent component\nconst [collapsed, setCollapsed] = useState({});\n\nconst SidebarTree = ({ datatree = {}, onSelectionChange, collapsed, setCollapsed }) => {\n  // Remove local collapsed state from SidebarTree\n\n  const handleSelect = (key) => {\n    let newSelected;\n    if (selectedNodes.includes(key)) {\n      newSelected = selectedNodes.filter((k) => k !== key);\n    } else {\n      newSelected = [...selectedNodes, key];\n    }\n    if (onSelectionChange) onSelectionChange(newSelected);\n  };\n\n  // Use a unique path for each node\n  const toggleCollapse = (nodePath) => {\n    setCollapsed((prev) => ({\n      ...prev,\n      [nodePath]: prev[nodePath] === undefined ? false : !prev[nodePath],\n    }));\n  };\n\n  const renderNodes = (tree, level = 1, parentKeys = []) => {\n    if (!tree || typeof tree !== \"object\" || Array.isArray(tree)) return null;\n    const entries = Object.entries(tree);\n    return entries.map(([key, value], idx) => {\n      const nodePath = [...parentKeys, key].join(\"/\"); // Unique path for each node\n      const hasChildren =\n        value.children &&\n        typeof value.children === \"object\" &&\n        !Array.isArray(value.children) &&\n        Object.keys(value.children).length > 0;\n      const isCollapsed = collapsed[nodePath] !== undefined ? collapsed[nodePath] : true;\n      const isLast = idx === entries.length - 1;\n\n      return (\n        <div\n          key={nodePath}\n          style={{\n            marginLeft: level * 14,\n            position: \"relative\",\n            whiteSpace: \"nowrap\",\n            display: \"flex\",\n            flexDirection: \"column\",\n            alignItems: \"flex-start\",\n            fontSize: \"14px\",\n            fontFamily: \"inherit\",\n            marginBottom: \"2px\",\n            paddingTop: \"4px\",\n            paddingBottom: \"4px\",\n          }}\n        >\n          {level > 0 && (\n            <div\n              style={{\n                position: \"absolute\",\n                left: -5,\n                top: 0,\n                height: \"100%\",\n                width: 16,\n                zIndex: 0,\n              }}\n            >\n              <div\n                style={{\n                  position: \"absolute\",\n                  left: -5,\n                  top: 0,\n                  bottom: isLast ? \"50%\" : 0,\n                  width: 2,\n                  background: \"#bbb\",\n                  height: hasChildren && !isCollapsed ? \"50%\" : \"100%\",\n                }}\n              />\n              <div\n                style={{\n                  position: \"absolute\",\n                  left: 7,\n                  top: 12,\n                  width: 9,\n                  height: 2,\n                  background: \"#bbb\",\n                }}\n              />\n            </div>\n          )}\n          <div style={{ display: \"flex\", alignItems: \"center\", position: \"relative\", zIndex: 1 }}>\n            {hasChildren && (\n              <button\n                onClick={() => toggleCollapse(nodePath)}\n                style={{\n                  border: \"none\",\n                  background: \"transparent\",\n                  cursor: \"pointer\",\n                  fontSize: \"14px\",\n                  marginRight: \"4px\",\n                  padding: 0,\n                  width: \"18px\",\n                  height: \"18px\",\n                  lineHeight: \"18px\",\n                  userSelect: \"none\",\n                }}\n                aria-label={isCollapsed ? \"Expand\" : \"Collapse\"}\n                tabIndex={-1}\n              >\n                {isCollapsed ? \"▶\" : \"▼\"}\n              </button>\n            )}\n            <input\n              type=\"checkbox\"\n              checked={selectedNodes.includes(key)}\n              onChange={() => handleSelect(key)}\n              style={{ marginRight: \"10px\" }}\n            />\n            {value.hyperlink ? (\n              <a\n                href={value.hyperlink}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                style={{\n                  textDecoration: \"none\",\n                  color: \"#2980b9\",\n                  fontWeight: 500,\n                  overflow: \"hidden\",\n                  textOverflow: \"ellipsis\",\n                  whiteSpace: \"nowrap\",\n                  maxWidth: \"100%\",\n                  display: \"inline-block\",\n                  verticalAlign: \"middle\",\n                }}\n                title={value.field_name}\n              >\n                {value.field_name}\n              </a>\n            ) : (\n              <span\n                style={{\n                  overflow: \"hidden\",\n                  textOverflow: \"ellipsis\",\n                  whiteSpace: \"nowrap\",\n                  maxWidth: \"160px\",\n                  display: \"inline-block\",\n                  verticalAlign: \"middle\",\n                }}\n                title={value.field_name}\n              >\n                {value.field_name}\n              </span>\n            )}\n          </div>\n          {hasChildren && !isCollapsed && (\n            <div style={{ width: \"100%\" }}>\n              {renderNodes(value.children, level + 1, [...parentKeys, key])}\n            </div>\n          )}\n        </div>\n      );\n    });\n  };\n\n  if (!datatreeTitle || !datatree) return null;\n  return (\n    <div\n      style={{\n        width: \"100%\",\n        padding: 10,\n        maxHeight: 800,\n        overflowY: \"auto\",\n        background: \"transparent\",\n      }}\n    >\n      <h4 style={{ margin: \"0 0 8px 0\", fontWeight: 600 }}>{datatreeTitle}</h4>\n      <div>{renderNodes(datatree)}</div>\n    </div>\n  );\n};\n\n  const [windowWidth, setWindowWidth] = useState(0); // Initial value\n\n    // Create a reusable function for getting the window width\n    const updateWindowWidth = () => {\n      if (typeof window !== 'undefined') {\n          setWindowWidth(window.innerWidth);\n      }\n  };\n\n  // Call the function on component mount to set the initial window width\n  useEffect(() => {\n      updateWindowWidth();\n  }, []);\n\n  useEffect(() => {\n    if (self_image) {\n      // Fetch the image data from the API endpoint\n      fetchImageData(self_image);\n    }\n  }, [self_image]);\n\n  const fetchImageData = async (imageUrl) => {\n    try {\n      const response = await axios.get(`${api_audio}${imageUrl}`, {\n        responseType: 'blob', // Set responseType to 'blob' to handle file response\n      });\n      const objectUrl = URL.createObjectURL(response.data); // Use a different variable name here\n      setImageSrc(objectUrl);\n      setImageSrc_name(imageUrl)\n    } catch (error) {\n      console.error('Error fetching image data:', error);\n    }\n  };\n\n\n\n  const listenContinuously = async () =>{\n    setlistening(true)\n    SpeechRecognition.startListening({\n      continuous: true,\n      language: \"en-US\",\n    })\n\n}\n\nconst isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n\n// Update convo_mode function:\nconst convo_mode = async () => {\n  console.log(\"convo_mode - listening?\", listening, \"isMobile:\", isMobile, \"convo_button:\", convo_button);\n  \n  if (!convo_button) {\n    console.log(\"Starting continuous listening...\");\n    setconvo_button(true);\n    listenContinuously();\n  } else {\n    console.log(\"Stopping continuous listening...\");\n    setconvo_button(false);\n    setlistening(false);\n    SpeechRecognition.stopListening();\n  }\n};\n\n// Also update your stopListening function to properly sync the states:\nconst stopListening = () => {\n  setlistening(false);\n  setconvo_button(false); // Add this line to sync the states\n  SpeechRecognition.stopListening();\n  console.log(\"Stopping Listening, isListening=\", listening);\n};\n\n\n  const listenSession = () =>{\n    if (session_listen) {\n    setsession_listen(false)\n  }\n  else{\n    setsession_listen(true)\n  }\n    }\n\n\n\n\n  const handleInputText = (event) => {\n    // Update the state with the input text\n    setTextString(event.target.value);\n  \n    // Set a variable to indicate that the user used the chat window\n    setUserUsedChatWindow(true);\n  };\n\n  const handleOnKeyDown = (e) => {\n    if (e.key === \"Enter\") {\n      console.log(\"textString :>> \", textString);\n      myFunc(textString, { api_body: { keyword: \"\" } }, 4);\n      setTextString(\"\");\n    }\n  };\n\n\n  const click_listenButton = () => {\n    setlistenButton(true)\n    if (!listening) {\n      listenContinuously()\n    }\n    setButtonName(\"Please Speak\")\n    console.log(\"listening button listen click\");\n    console.log(listenButton);\n  };\n  const [editingDataframe, setEditingDataframe] = useState(null);\n  const [editedDataframe, setEditedDataframe] = useState(null);\n\n  const myFunc = async (ret, command, type) => {\n\n  let originalText = null;\n  let replacementPrompt = null;\n\n  if (type === 9) {\n    console.log(\"Text replacement test - type 9 detected\");\n    originalText = command.api_body?.original_text || \"\"; // Set original text\n    replacementPrompt = command.api_body?.replacement_prompt || \"\"; // Set replacement prompt\n\n    console.log(\"Original text:\", originalText);\n    console.log(\"Replacement prompt:\", replacementPrompt);\n    // // Return test string for replacement\n    // return \"TEST REPLACEMENT TEXT - This is a TEST\";\n  }\n\n    setMessage(` (${command[\"api_body\"][\"keyword\"]}) ${ret},`);\n    const text = [...g_anwers, { user: ret }];\n    setAnswers([...text]);\n    try {\n      console.log(\"api call on listen...\", command);\n      console.log(\"selected_nodes\", selectedNodes);\n      setApiInProgress(true); // Set API in progress to true\n      // stopListening()\n      // how do I get the dataframe from type?\n      let dataframe = null;\n      if (type === \"dataframe_edit\" && command.api_body && command.api_body.dataframe) {\n        dataframe = command.api_body.dataframe;\n      }\n      const body = {\n        tigger_type: type,\n        api_key: api_key,\n        text: text,\n        self_image: imageSrc_name,\n        face_data: faceData.current,\n        refresh_ask: refresh_ask,\n        client_user: client_user,\n        force_db_root:force_db_root,\n        session_listen:session_listen,\n        before_trigger_vars:before_trigger_vars,\n        selected_actions: selectedActions,\n        selected_nodes: selectedNodes,\n        dataframe: dataframe,\n        originalText: originalText,\n        replacementPrompt: replacementPrompt,\n      };\n      console.log(\"api\");\n      const { data } = await axios.post(api, body);\n      console.log(\"data :>> \", data, body);\n      if (data[\"self_image\"] && data[\"self_image\"] !== imageSrc_name) {\n        fetchImageData(data[\"self_image\"]); // Fetch image data if it's different\n      }\n      \n      if (data[\"text\"]) {\n        setAnswers(data[\"text\"]);\n        g_anwers = [...data[\"text\"]];\n      }\n      \n      if (audioRef.current) {\n        audioRef.current.pause(); // Pause existing playback if any\n      }\n\n      if (data[\"audio_path\"]) {\n        const apiUrlWithFileName = `${api_audio}${data[\"audio_path\"]}`;\n        audioRef.current = new Audio(apiUrlWithFileName);\n    \n        try {\n            await audioRef.current.play();\n            \n            // Set state to indicate speaking in progress\n            setSpeakingInProgress(true);\n            setButtonName_listen(\"Speaking\");\n    \n            // Await playback completion\n            await new Promise((resolve) => {\n                audioRef.current.onended = () => {\n                    console.log(\"Audio playback finished.\");\n                    resolve();\n                };\n            });\n    \n        } catch (error) {\n            console.error(\"Audio playback error:\", error);\n        } finally {\n            // Cleanup or reset after playback\n            audioRef.current = null;\n            setSpeakingInProgress(false);\n            setButtonName_listen(\"Listen\");\n        }\n    }\n\n      setButtonName(\"Click and Ask\")\n      setButtonName_listen(\"Listening\")\n      setSpeakingInProgress(false)\n      setApiInProgress(false)\n      setListenAfterReply(data[\"listen_after_reply\"]);\n      \n      console.log(\"listen after reply\", data[\"listen_after_reply\"], listenAfterReply);\n\n      if (data[\"page_direct\"] !== false && data[\"page_direct\"] !== null) {\n        console.log(\"api has page direct\", data[\"page_direct\"]);\n        // window.location.reload();\n        window.location.href = data[\"page_direct\"];\n      }\n\n      if (UserUsedChatWindow) {\n        setUserUsedChatWindow(false)\n      }\n      else if (listenAfterReply==true) {\n        console.log(\"API END HIT listenAfterReply==TRUE\")\n        setButtonName_listen(\"Awaiting your Answer please speak\")\n      }\n      else if (listenButton) {\n      setlistenButton(false)\n      stopListening()\n      }\n      else if (convo_button){\n        console.log(\"convo mode\")\n        // listenContinuously()\n      }\n\n      if (data[\"dataframe\"]) {\n        setEditingDataframe(data[\"dataframe\"]);\n        setEditedDataframe(data[\"dataframe\"]);\n        return; // Exit further processing if you want\n}\n      if (type === 9) {\n        return data[\"text\"][data[\"text\"].length - 1].response || \"\";\n      }\n\n    } catch (error) {\n      console.log(\"api call on listen failed!\", error);\n      setApiInProgress(false); // Set API in progress to false on error\n      setlistenButton(false)\n    }\n\n    // updateWindowWidth();\n    console.log(\"ReSize Window\")\n    setSelectedActions([]);\n  };\n\n// Recursive function to find a node by key in the datatree\nfunction findNodeByKey(tree, key) {\n  if (!tree || typeof tree !== \"object\") return null;\n  for (const [k, value] of Object.entries(tree)) {\n    if (k === key) return value;\n    if (value.children) {\n      const found = findNodeByKey(value.children, key);\n      if (found) return found;\n    }\n  }\n  return null;\n}\n\n  const background_color_chat = refresh_ask?.color_dict?.background_color_chat || 'transparent';\n  const splitImage = self_image.split('.')[0]; // Split by dot\n  const placeholder = `Chat with ${splitImage}`;\n\n  const firstKey = selectedNodes[0] || null;\n  const nodeObj = firstKey ? findNodeByKey(datatree, firstKey) : null;\n  const nodeTitle = nodeObj?.field_name;\n  const nodeLink = nodeObj?.hyperlink;\n\n  const [showSidebar, setShowSidebar] = useState(false);\n  const [sidebarWide, setSidebarWide] = useState(450);\n\nreturn (\n  <div style={{ display: \"flex\", width: \"100%\", minHeight: \"100vh\" }}>\n    {/* Sidebar Toggle and Sidebar - Only show if not mobile or if sidebar is open */}\n    {(!isMobile || showSidebar) && (\n      <div style={{ display: \"flex\", flexDirection: \"column\", flexShrink: 0 }}>\n        {/* Sidebar Toggle Button */}\n        <div style={{ display: \"flex\", alignItems: \"center\", padding: isMobile ? \"2px 4px\" : \"4px 8px\" }}>\n          <button\n            onClick={() => setShowSidebar((prev) => !prev)}\n            style={{\n              fontSize: isMobile ? \"16px\" : \"18px\",\n              padding: isMobile ? \"2px 8px\" : \"4px 10px\",\n              marginRight: isMobile ? \"3px\" : \"6px\",\n              border: \"none\",\n              borderRadius: \"50%\",\n              background: \"transparent\",\n              color: \"#2980b9\",\n              cursor: \"pointer\",\n              height: isMobile ? \"28px\" : \"32px\",\n              width: isMobile ? \"28px\" : \"32px\",\n              boxShadow: \"none\",\n              outline: \"none\",\n              transition: \"background 0.2s\",\n            }}\n            aria-label={showSidebar ? \"Hide Sidebar\" : \"Show Sidebar\"}\n          >\n            {showSidebar ? \"⏴\" : \"⏵\"}\n          </button>\n        </div>\n        \n        {/* Sidebar Width Toggle Button (only visible when sidebar is open) */}\n        {showSidebar && !isMobile && (\n          <button\n            onClick={() => setSidebarWide((prev) => (prev === 450 ? 250 : 450))}\n            style={{\n              border: \"transparent\",\n              background: \"transparent\",\n              cursor: \"pointer\",\n              height: \"32px\",\n              margin: \"6px 0 0 0\",\n              width: \"32px\",\n              alignSelf: \"flex-end\",\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              borderRadius: \"50%\",\n              boxShadow: \"none\",\n              transition: \"background 0.2s\",\n            }}\n          >\n            {sidebarWide === 450 ? <span>⏪</span> : <span>⏩</span>}\n          </button>\n        )}\n        \n        {/* Sidebar Tree */}\n        {showSidebar && (\n          <div \n            style={{ \n              width: isMobile ? \"280px\" : sidebarWide, \n              borderRight: \"1px solid #ccc\", \n              padding: isMobile ? 5 : 10, \n              transition: \"width 0.2s\",\n              maxHeight: isMobile ? \"50vh\" : \"none\",\n              overflowY: isMobile ? \"auto\" : \"visible\"\n            }}\n          >\n            <SidebarTree\n              datatree={datatree}\n              onSelectionChange={setSelectedNodes}\n              collapsed={collapsed}\n              setCollapsed={setCollapsed}\n            />          \n          </div>\n        )}\n      </div>\n    )}\n\n    {/* Main Content */}\n    <div \n      style={{ \n        flex: 1, \n        padding: isMobile ? \"4px\" : \"8px\", // Reduce padding on mobile\n        minWidth: 0 // Prevent flex item from overflowing\n      }}\n    >\n      {/* Mobile-only sidebar toggle when sidebar is hidden */}\n      {isMobile && !showSidebar && (\n        <div style={{ marginBottom: \"8px\" }}>\n          <button\n            onClick={() => setShowSidebar(true)}\n            style={{\n              fontSize: \"16px\",\n              padding: \"4px 8px\",\n              border: \"1px solid #2980b9\",\n              borderRadius: \"4px\",\n              background: \"transparent\",\n              color: \"#2980b9\",\n              cursor: \"pointer\",\n            }}\n          >\n            {showSidebar ? \"⏴\" : \"⏵\"}\n          </button>\n        </div>\n      )}\n\n      <div>\n        {firstKey && nodeObj ? (\n          <div style={{ fontSize: isMobile ? \"14px\" : \"16px\", marginBottom: \"8px\" }}>\n            Working Page:{\" \"}\n            {nodeLink ? (\n              <a href={nodeLink} target=\"_blank\" rel=\"noopener noreferrer\">\n                {nodeTitle}\n              </a>\n            ) : (\n              nodeTitle\n            )}\n          </div>\n        ) : (\n          <div></div>\n        )}\n\n        {/* Show other selected nodes, if any */}\n        {selectedNodes.length > 1 && (\n          <div style={{ marginTop: 8, fontSize: isMobile ? \"12px\" : \"14px\" }}>\n            <strong>Extra Context:</strong>{\" \"}\n            {selectedNodes.slice(1).map((key, idx) => {\n              const node = findNodeByKey(datatree, key);\n              return (\n                <span key={key} style={{ marginRight: 8 }}>\n                  {node?.field_name || key}\n                  {idx < selectedNodes.length - 2 ? \",\" : \"\"}\n                </span>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Rest of your content stays the same but with mobile padding adjustments */}\n      <div style={{ display: 'flex', flexDirection: 'column', width: '100%' }}>\n        {/* Media Display */}\n        <div>\n          <MediaDisplay\n            showImage={showImage}\n            imageSrc={imageSrc}\n            largeHeight={isMobile ? 80 : 100}\n            largeWidth={isMobile ? 80 : 100}\n            smallHeight={isMobile ? 30 : 40}\n            smallWidth={isMobile ? 30 : 40}\n          />\n        </div>\n\n        {/* Chat window */}\n        <div style={{ \n          flex: showImage ? 1 : '100%', \n          overflowY: 'auto', \n          maxHeight: isMobile ? '300px' : '450px' \n        }}>\n          {show_conversation && (\n            <div\n              style={{\n                display: 'flex',\n                flexDirection: 'column',\n                maxHeight: isMobile ? '300px' : '450px',\n                height: isMobile ? '300px' : '450px',\n                overflowY: 'auto',\n                padding: isMobile ? '5px' : '10px',\n              }}\n            >\n              {/* Your chat messages - keep existing code */}\n              {answers.map((answer, idx) => (\n                <div\n                  key={idx}\n                  className=\"chat-message-container\"\n                  style={{\n                    marginBottom: '5px',\n                    padding: isMobile ? '3px' : '5px',\n                    borderRadius: '4px',\n                    border: '1px solid #ccc',\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.1)',\n                  }}\n                >\n                  {/* Keep your existing chat message content */}\n                  <div\n                    className=\"chat-user\"\n                    style={{\n                      textAlign: 'right',\n                      marginLeft: 'auto',\n                      padding: isMobile ? '3px' : '5px',\n                      fontSize: isMobile ? '12px' : '14px'\n                    }}\n                  >\n                    {client_user}: <span>{answer.user}</span>\n                  </div>\n                  <div\n                    className=\"chat-response-container\"\n                    style={{\n                      display: 'flex',\n                      alignItems: 'flex-start',\n                      backgroundColor: background_color_chat,\n                      padding: isMobile ? '5px' : '10px',\n                    }}\n                  >\n                    {imageSrc && (\n                      <div className=\"chat-image\" style={{ marginRight: isMobile ? '5px' : '10px' }}>\n                        <img src={imageSrc} alt=\"response\" style={{ width: isMobile ? '30px' : '50px' }} />\n                      </div>\n                    )}\n                    <div\n                      className=\"chat-response-text\"\n                      style={{ \n                        flex: 1, \n                        wordBreak: 'break-word',\n                        fontSize: isMobile ? '12px' : '14px'\n                      }}\n                    >\n                      {answer.resp\n                        ? <span dangerouslySetInnerHTML={{ __html: answer.resp }} />\n                        : <span className=\"spinner\" />}\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Input text section - keep existing but adjust for mobile */}\n      {input_text && (\n        <>\n          <hr style={{ margin: '3px 0' }} />\n          <div className=\"form-group\" style={{ display: \"flex\", alignItems: \"center\" }}>\n            <input\n              className=\"form-control\"\n              type=\"text\"\n              placeholder={placeholder}\n              value={textString}\n              onChange={handleInputText}\n              onKeyDown={handleOnKeyDown}\n              style={{ \n                flex: 1,\n                fontSize: isMobile ? '14px' : '16px',\n                padding: isMobile ? '6px' : '8px'\n              }}\n            />\n          </div>\n          <hr style={{ margin: '3px 0' }} />\n        </>\n      )}\n\n          {editingDataframe &&\n            Array.isArray(editingDataframe) &&\n            editingDataframe.length > 0 &&\n            editedDataframe &&\n            Array.isArray(editedDataframe) &&\n            editedDataframe.length > 0 && (\n              <div\n                style={{\n            padding: 20,\n            border: \"2px solid #b3c6e0\",\n            borderRadius: \"12px\",\n            background: \"rgba(240, 248, 255, 0.7)\",\n            boxShadow: \"0 2px 12px rgba(100, 150, 200, 0.08)\",\n            marginBottom: 16,\n            marginTop: 8,\n                }}\n              >\n                <h3 style={{ marginTop: 0, color: \"#2a3b5d\" }}>Edit Dataframe</h3>\n                <table\n            style={{\n              borderCollapse: \"collapse\",\n              width: \"100%\",\n              background: \"rgba(255,255,255,0.5)\",\n              borderRadius: \"8px\",\n              overflow: \"hidden\",\n              boxShadow: \"0 1px 4px rgba(100,150,200,0.06)\",\n            }}\n                >\n            <thead>\n              <tr>\n                {Object.keys(editingDataframe[0]).map((col) => (\n                  <th\n              key={col}\n              style={{\n                border: \"1px solid #c8d6e5\",\n                padding: 6,\n                background: \"rgba(200,220,255,0.35)\",\n                color: \"#2a3b5d\",\n                fontWeight: 600,\n              }}\n                  >\n              {col}\n                  </th>\n                ))}\n              </tr>\n            </thead>\n            <tbody>\n              {editedDataframe.map((row, rowIdx) => (\n                <tr key={rowIdx}>\n                  {Object.keys(row).map((col) => (\n              <td\n                key={col}\n                style={{\n                  border: \"1px solid #c8d6e5\",\n                  padding: 4,\n                  background: \"rgba(255,255,255,0.3)\",\n                }}\n              >\n                <input\n                  value={row[col]}\n                  onChange={e => {\n                    const newDF = editedDataframe.map((r, i) =>\n                i === rowIdx ? { ...r, [col]: e.target.value } : r\n                    );\n                    setEditedDataframe(newDF);\n                  }}\n                  style={{\n                    width: \"100%\",\n                    background: \"rgba(255,255,255,0.5)\",\n                    border: \"1px solid #b3c6e0\",\n                    borderRadius: \"4px\",\n                    padding: \"2px 4px\",\n                    color: \"#2a3b5d\",\n                  }}\n                />\n              </td>\n                  ))}\n                </tr>\n              ))}\n            </tbody>\n                </table>\n                <div style={{ marginTop: 12 }}>\n            <button\n              style={{\n                marginRight: 8,\n                background: \"rgba(42, 59, 93, 0.8)\",\n                color: \"#fff\",\n                border: \"none\",\n                borderRadius: \"4px\",\n                padding: \"6px 14px\",\n                cursor: \"pointer\",\n              }}\n              onClick={async () => {\n                // Send editedDataframe to API\n  await myFunc(textString, { api_body: { dataframe: editedDataframe } }, \"dataframe_edit\");\n  setEditingDataframe(null);\n  setEditedDataframe(null);\n              }}\n            >\n              Save\n            </button>\n            <button\n              style={{\n                background: \"rgba(200,220,255,0.5)\",\n                color: \"#2a3b5d\",\n                border: \"none\",\n                borderRadius: \"4px\",\n                padding: \"6px 14px\",\n                cursor: \"pointer\",\n              }}\n              onClick={() => {\n                setEditingDataframe(null);\n                setEditedDataframe(null);\n              }}\n            >\n              Cancel\n            </button>\n                </div>\n              </div>\n          )}\n\n<div className=\"form-group\" style={{ \n        display: \"flex\", \n        alignItems: \"left\", \n        flexWrap: \"wrap\",\n        gap: isMobile ? \"4px\" : \"8px\"\n      }}>\n        <button\n          onClick={click_listenButton}\n          style={{\n            marginLeft: isMobile ? 4 : 8,\n            background: listenButton ? 'rgb(26, 182, 28)' : \"rgb(19, 123, 193)\",\n            border: 'none',\n            borderRadius: '50%',\n            width: isMobile ? 32 : 36,\n            height: isMobile ? 32 : 36,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            cursor: 'pointer',\n            color: 'white',\n            fontSize: isMobile ? 16 : 20,\n            boxShadow: '0 1px 4px rgba(0,0,0,0.08)',\n            transition: 'background 0.2s',\n          }}\n          title=\"Click and Ask\"\n        >\n          <span role=\"img\" aria-label=\"microphone\">🎤</span>\n        </button>\n      \n<button\n  onClick={convo_mode}\n  onMouseEnter={() => setShowTooltip_conv(true)}\n  onMouseLeave={() => setShowTooltip_conv(false)}\n  style={{\n    marginLeft: 8,\n    background: convo_button ? 'rgb(26, 182, 28)' : \"rgb(19, 123, 193)\",\n    border: 'none',\n    borderRadius: '50%',\n    width: 36,\n    height: 36,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    cursor: 'pointer',\n    color: 'white',\n    fontSize: 20,\n    boxShadow: '0 1px 4px rgba(0,0,0,0.08)',\n    transition: 'background 0.2s',\n    position: 'relative',\n  }}\n>\n<span role=\"img\" aria-label={convo_button ? \"paper\" : \"x\"}>\n  {convo_button ? \"🎧\" : \"🔇\"}\n</span>  {showTooltip_conv && (\n    <span\n      style={{\n        position: \"absolute\",\n        top: \"-38px\",\n        left: \"50%\",\n        transform: \"translateX(-50%)\",\n        background: \"#222\",\n        color: \"#fff\",\n        padding: \"4px 10px\",\n        borderRadius: \"4px\",\n        fontSize: \"13px\",\n        whiteSpace: \"nowrap\",\n        zIndex: 1000,\n        pointerEvents: \"none\",\n      }}\n    >\n      {convo_button ? \"Listening On\" : \"Listening OFF\"}\n    </span>\n  )}\n</button>\n\n\n<button\n  onClick={listenSession}\n  onMouseEnter={() => setShowTooltip(true)}\n  onMouseLeave={() => setShowTooltip(false)}\n  style={{\n    marginLeft: 8,\n    background: session_listen ? 'rgb(26, 182, 28)' : \"rgb(19, 123, 193)\",\n    border: 'none',\n    borderRadius: '50%',\n    width: 36,\n    height: 36,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    cursor: 'pointer',\n    color: 'white',\n    fontSize: 20,\n    boxShadow: '0 1px 4px rgba(0,0,0,0.08)',\n    transition: 'background 0.2s',\n    position: 'relative',\n  }}\n>\n<span role=\"img\" aria-label={session_listen ? \"paper\" : \"x\"}>\n  {session_listen ? \"📄\" : \"📄\"}\n</span>  {showTooltip && (\n<span\n  style={{\n    position: \"absolute\",\n    top: \"-38px\",\n    left: \"50%\",\n    transform: \"translateX(-50%)\",\n    background: 'rgb(235, 243, 244)',\n    color: 'rgb(45, 68, 72)',\n    padding: \"4px 10px\",\n    borderRadius: \"4px\",\n    fontSize: \"13px\",\n    whiteSpace: \"normal\",      // allow text to wrap\n    maxWidth: \"220px\",         // prevent it from being too wide\n    textAlign: \"center\",       // center the text\n    zIndex: 1000,\n    pointerEvents: \"none\",\n  }}\n>\n  {session_listen\n    ? \"ON\"\n    : `Enable's \"hey ${splitImage}\" commands & holds Transcript\"`}\n</span>\n  )}\n</button>\n\n</div>\n\n\n              {/* Agent Actions Horizontal Button-Style Multi-Select */}\n                {Array.isArray(agent_actions) && agent_actions.length > 0 && (\n                  <div\n                    style={{\n                      display: 'flex',\n                      flexWrap: 'wrap',\n                      justifyContent: 'right',\n                      marginTop: '8px',\n                      gap: '6px',\n                      alignItems: 'right',\n                    }}\n                  >\n                    <span style={{ fontWeight: 600, marginRight: 12, minWidth: 90, textAlign: 'left' }}>\n                      Agent Actions:\n                    </span>\n                    {agent_actions.map((action, idx) => {\n              const selected = selectedActions.includes(action);\n              return (\n                <button\n                  key={idx}\n                  onClick={() => {\n                    if (selected) {\n                      setSelectedActions(selectedActions.filter((a) => a !== action));\n                    } else {\n                      setSelectedActions([...selectedActions, action]);\n                    }\n                  }}\n                  style={{\n                    fontSize: '12px',\n                    padding: '5px 10px',\n                    backgroundColor: selected ? 'rgb(59, 159, 72)' : 'rgb(200, 233, 238)',\n                    color: selected ? 'white' : 'black',\n                    border: '1px solidrgb(239, 242, 244)',\n                    borderRadius: '4px',\n                    cursor: 'pointer',\n                  }}\n                >\n                  {action}\n                </button>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Dictaphone component */}\n        <div className=\"p-2\" style={{ marginBottom: '15px' }}>\n          <Dictaphone\n            commands={commands}\n            myFunc={myFunc}\n            listenAfterReply={listenAfterReply}\n            no_response_time={no_response_time}\n            apiInProgress={apiInProgress}\n            listenButton={listenButton}\n            session_listen={session_listen}\n            listening={listening}\n            initialFinalTranscript={kwargs.initialFinalTranscript || \"\"}\n            splitImage={splitImage}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default CustomVoiceGPT;\n\n\n  // useEffect(() => {\n  //   const loadModels = async () => {\n  //     const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\n\n  //     Promise.all([\n  //       faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\n  //       faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\n  //       faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\n  //       faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL),\n  //       faceapi.nets.ageGenderNet.loadFromUri(MODEL_URL),\n  //     ]).then(() => setModelsLoaded(true));\n  //   };\n  //   loadModels();\n  //   const interval = setInterval(() => {\n  //     // console.log(\"faceData.current :>> \", faceData.current);\n  //   }, 3000);\n  //   return () => clearInterval(interval);\n  // }, []);\n\n    // const startVideo = () => {\n  //   setCaptureVideo(true);\n  //   navigator.mediaDevices\n  //     .getUserMedia({ video: { width: 300 } })\n  //     .then((stream) => {\n  //       let video = videoRef.current;\n  //       video.srcObject = stream;\n  //       video.play();\n  //     })\n  //     .catch((err) => {\n  //       console.error(\"error:\", err);\n  //     });\n  // };\n\n  // const handleVideoOnPlay = () => {\n  //   setInterval(async () => {\n  //     if (canvasRef && canvasRef.current) {\n  //       canvasRef.current.innerHTML = faceapi.createCanvasFromMedia(\n  //         videoRef.current\n  //       );\n  //       const displaySize = {\n  //         width: videoWidth,\n  //         height: videoHeight,\n  //       };\n\n  //       faceapi.matchDimensions(canvasRef.current, displaySize);\n\n  //       const detections = await faceapi\n  //         .detectAllFaces(\n  //           videoRef.current,\n  //           new faceapi.TinyFaceDetectorOptions()\n  //         )\n  //         .withFaceLandmarks()\n  //         .withFaceExpressions();\n\n  //       const resizedDetections = faceapi.resizeResults(detections, displaySize);\n\n  //       if (resizedDetections.length > 0) {\n  //         faceData.current = resizedDetections;\n  //         if (!faceTriggered.current && face_recon) {\n  //           myFunc(\"\", { api_body: { keyword: \"\" } }, 2);\n  //           faceTriggered.current = true;\n  //         }\n  //       } else {\n  //         faceTimer && clearTimeout(faceTimer);\n  //         setTimeout(() => {\n  //           faceData.current = [];\n  //         }, 1000);\n  //       }\n\n  //       if (resizedDetections.length > 0 && !firstFace) {\n  //         firstFace = true;\n  //         if (kwargs.hello_audio) {\n  //           const audio = new Audio(kwargs.hello_audio);\n  //           audio.play();\n  //         }\n  //       }\n\n  //       canvasRef &&\n  //         canvasRef.current &&\n  //         canvasRef.current\n  //           .getContext(\"2d\")\n  //           .clearRect(0, 0, videoWidth, videoHeight);\n  //       canvasRef &&\n  //         canvasRef.current &&\n  //         faceapi.draw.drawDetections(canvasRef.current, resizedDetections);\n  //       canvasRef &&\n  //         canvasRef.current &&\n  //         faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetections);\n  //       canvasRef &&\n  //         canvasRef.current &&\n  //         faceapi.draw.drawFaceExpressions(\n  //           canvasRef.current,\n  //           resizedDetections\n  //         );\n  //     }\n  //   }, 300);\n  // };\n\n  // const closeWebcam = () => {\n  //   videoRef.current.pause();\n  //   videoRef.current.srcObject.getTracks()[0].stop();\n  //   setCaptureVideo(false);\n  // };","import React, { useEffect, useState } from \"react\"\nimport {\n  ComponentProps,\n  Streamlit,\n  withStreamlitConnection,\n} from \"streamlit-component-lib\"\nimport VoiceGPT from \"./VoiceGPT.jsx\"\n\nconst Main = (props: ComponentProps) => {\n  const { api, kwargs } = props.args\n  useEffect(() => Streamlit.setFrameHeight())\n  return (\n    <>\n      <VoiceGPT api={api} kwargs={kwargs} />\n    </>\n  )\n}\n\nexport default withStreamlitConnection(Main)\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport Main from \"./Main\"\n// Lots of import to define a Styletron engine and load the light theme of baseui\nimport { Client as Styletron } from \"styletron-engine-atomic\"\nimport { Provider as StyletronProvider } from \"styletron-react\"\nimport { ThemeProvider, LightTheme } from \"baseui\"\n\nconst engine = new Styletron()\n\n// Wrap your CustomSlider with the baseui them\nReactDOM.render(\n  <React.StrictMode>\n    <StyletronProvider value={engine}>\n      <ThemeProvider theme={LightTheme}>\n        <Main />\n      </ThemeProvider>\n    </StyletronProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n"],"sourceRoot":""}